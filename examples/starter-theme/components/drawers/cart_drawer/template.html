<div class="cart-drawer cart-drawer--{{ settings.position }}"
     data-cart-drawer
     aria-hidden="true"
     role="dialog"
     aria-labelledby="cart-drawer-title">

  <!-- Overlay -->
  <div class="cart-drawer__overlay" data-cart-drawer-close></div>

  <!-- Drawer Content -->
  <div class="cart-drawer__container">
    <!-- Header -->
    <header class="cart-drawer__header">
      <h2 id="cart-drawer-title" class="cart-drawer__title">
        {{ settings.title }}
        <span class="cart-drawer__count" data-cart-count>(0)</span>
      </h2>
      <button class="cart-drawer__close" data-cart-drawer-close aria-label="Close cart">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </header>

    <!-- Cart Items -->
    <div class="cart-drawer__body" data-cart-items>
      <!-- Empty State -->
      <div class="cart-drawer__empty" data-cart-empty>
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
        <p class="cart-drawer__empty-message">{{ settings.empty_message }}</p>
        <a href="{{ settings.empty_button_url }}" class="button button--primary" data-cart-drawer-close>
          {{ settings.empty_button_text }}
        </a>
      </div>

      <!-- Cart Item Template -->
      <template data-cart-item-template>
        <div class="cart-item" data-cart-item data-line-key="{key}">
          <div class="cart-item__media">
            <img src="{image}" alt="{title}" class="cart-item__image" loading="lazy">
          </div>
          <div class="cart-item__details">
            <div class="cart-item__header">
              <a href="{url}" class="cart-item__title">{title}</a>
              <button class="cart-item__remove" data-remove-item="{key}" aria-label="Remove item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>
            <p class="cart-item__variant">{variant}</p>
            <div class="cart-item__footer">
              <div class="cart-item__quantity">
                <button class="cart-item__quantity-btn" data-decrease-quantity="{key}" aria-label="Decrease quantity">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12"/>
                  </svg>
                </button>
                <input type="number"
                       class="cart-item__quantity-input"
                       value="{quantity}"
                       min="0"
                       data-quantity-input="{key}"
                       aria-label="Quantity">
                <button class="cart-item__quantity-btn" data-increase-quantity="{key}" aria-label="Increase quantity">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                  </svg>
                </button>
              </div>
              <span class="cart-item__price">{price}</span>
            </div>
          </div>
        </div>
      </template>
    </div>

    <!-- Footer -->
    <footer class="cart-drawer__footer" data-cart-footer>
      <div class="cart-drawer__subtotal">
        <span>{{ settings.subtotal_label }}</span>
        <span class="cart-drawer__subtotal-value" data-cart-subtotal>$0.00</span>
      </div>

      {% if settings.show_shipping_note %}
        <p class="cart-drawer__note">{{ settings.shipping_note }}</p>
      {% endif %}

      <div class="cart-drawer__actions">
        <a href="/cart" class="button button--secondary" data-cart-drawer-close>
          {{ settings.view_cart_text }}
        </a>
        <a href="/checkout" class="button button--primary">
          {{ settings.checkout_button_text }}
        </a>
      </div>
    </footer>
  </div>
</div>

<script>
(function() {
  const drawer = document.querySelector('[data-cart-drawer]');
  if (!drawer) return;

  const openButtons = document.querySelectorAll('[data-cart-drawer-open]');
  const closeButtons = drawer.querySelectorAll('[data-cart-drawer-close]');

  function openDrawer() {
    drawer.setAttribute('aria-hidden', 'false');
    drawer.classList.add('is-open');
    document.body.style.overflow = 'hidden';
  }

  function closeDrawer() {
    drawer.setAttribute('aria-hidden', 'true');
    drawer.classList.remove('is-open');
    document.body.style.overflow = '';
  }

  openButtons.forEach(btn => btn.addEventListener('click', openDrawer));
  closeButtons.forEach(btn => btn.addEventListener('click', closeDrawer));

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && drawer.classList.contains('is-open')) {
      closeDrawer();
    }
  });

  // Expose API
  window.CartDrawer = { open: openDrawer, close: closeDrawer };
})();
</script>
