<button class="back-to-top back-to-top--{{ settings.position }} back-to-top--{{ settings.style }} {% if settings.show_progress %}back-to-top--with-progress{% endif %}"
        data-back-to-top
        data-show-after="{{ settings.show_after }}"
        aria-label="{{ settings.aria_label }}"
        style="--back-to-top-bg: {{ settings.background_color }}; --back-to-top-color: {{ settings.icon_color }}">

  {% if settings.show_progress %}
    <svg class="back-to-top__progress" viewBox="0 0 100 100">
      <circle class="back-to-top__progress-track" cx="50" cy="50" r="45"/>
      <circle class="back-to-top__progress-bar" cx="50" cy="50" r="45" data-progress-bar/>
    </svg>
  {% endif %}

  <svg class="back-to-top__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
    <polyline points="18 15 12 9 6 15"/>
  </svg>
</button>

<script>
(function() {
  const button = document.querySelector('[data-back-to-top]');
  if (!button) return;

  const showAfter = parseInt(button.dataset.showAfter) || 300;
  const progressBar = button.querySelector('[data-progress-bar]');
  let isVisible = false;

  function updateVisibility() {
    const shouldShow = window.scrollY > showAfter;

    if (shouldShow !== isVisible) {
      isVisible = shouldShow;
      button.classList.toggle('is-visible', shouldShow);
    }
  }

  function updateProgress() {
    if (!progressBar) return;

    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrolled = (window.scrollY / docHeight) * 100;
    const circumference = 2 * Math.PI * 45;
    const offset = circumference - (scrolled / 100) * circumference;

    progressBar.style.strokeDashoffset = offset;
  }

  function scrollToTop() {
    window.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }

  // Initialize progress bar
  if (progressBar) {
    const circumference = 2 * Math.PI * 45;
    progressBar.style.strokeDasharray = circumference;
    progressBar.style.strokeDashoffset = circumference;
  }

  // Event listeners
  window.addEventListener('scroll', () => {
    updateVisibility();
    updateProgress();
  }, { passive: true });

  button.addEventListener('click', scrollToTop);

  // Initial state
  updateVisibility();
  updateProgress();
})();
</script>
