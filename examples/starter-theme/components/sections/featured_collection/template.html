<section class="featured-collection" style="background-color: {{ settings.background_color }}">
  <div class="container">
    {% if settings.heading %}
      <div class="section-header">
        <h2 class="section-heading">{{ settings.heading }}</h2>
        {% if settings.subheading %}
          <p class="section-subheading">{{ settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% if collection and collection.products %}
      <div class="product-grid columns-{{ settings.products_per_row }}">
        {% for product in collection.products|slice:settings.products_to_show %}
          <div class="product-card">
            <div class="product-image">
              <a href="{{ product.url }}" class="product-image-link">
                {% if product.featured_image %}
                  <img src="{{ product.featured_image }}"
                       alt="{{ product.title }}"
                       loading="lazy">
                {% else %}
                  <div class="product-image-placeholder">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                      <circle cx="8.5" cy="8.5" r="1.5"/>
                      <polyline points="21 15 16 10 5 21"/>
                    </svg>
                  </div>
                {% endif %}
              </a>

              <!-- Badges -->
              <div class="product-badges">
                {% if product.compare_at_price %}
                  <span class="badge badge--sale">Sale</span>
                {% endif %}
                {% if product.is_new %}
                  <span class="badge badge--new">New</span>
                {% endif %}
              </div>

              <!-- Quick Add -->
              {% if settings.show_quick_add %}
                <button class="product-quick-add button button--cta"
                        data-product-id="{{ product.id }}"
                        aria-label="Add {{ product.title }} to cart">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="9" cy="21" r="1"/>
                    <circle cx="20" cy="21" r="1"/>
                    <path d="m1 1 4 4h16l-2 9H7"/>
                  </svg>
                  <span>Add to Cart</span>
                </button>
              {% endif %}
            </div>

            <div class="product-info">
              {% if settings.show_vendor and product.vendor %}
                <p class="product-vendor">{{ product.vendor }}</p>
              {% endif %}

              <h3 class="product-title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>

              <div class="product-price">
                {% if product.compare_at_price %}
                  <span class="sale-price">{{ product.price|money }}</span>
                  <span class="compare-price">{{ product.compare_at_price|money }}</span>
                {% else %}
                  <span class="regular-price">{{ product.price|money }}</span>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

      {% if settings.show_view_all %}
        <div class="view-all">
          <a href="{{ collection.url }}" class="view-all-link">
            {{ settings.view_all_text }}
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"/>
              <polyline points="12 5 19 12 12 19"/>
            </svg>
          </a>
        </div>
      {% endif %}
    {% else %}
      <div class="no-products">
        <div class="no-products__icon">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="m1 1 4 4h16l-2 9H7"/>
          </svg>
        </div>
        <p class="no-products__text">No products in this collection yet.</p>
      </div>
    {% endif %}
  </div>
</section>
